$(document).ready(function(){var e,t,o=L.map("map",{center:[39.83,-98.58],zoom:5,minZoom:5}),n=L.esri.basemapLayer("Streets").addTo(o);function r(t){e.eachLayer(function(e){var o=e.feature.properties,n=a(o[t]),r="<b>"+String(o[t])+" Unemployed</b><br><i>"+o.name+"</i> in </i>"+t+"</i>";e.setRadius(n),e.bindPopup(r,{offset:new L.Point(0,-n)})})}function a(e){var t=.1*e;return Math.sqrt(t/Math.PI)}document.querySelector("#basemaps").addEventListener("change",function(e){!function(e){n&&o.removeLayer(n),n=L.esri.basemapLayer(e),o.addLayer(n),t&&o.removeLayer(t),"ShadedRelief"===e||"Oceans"===e||"Gray"===e||"DarkGray"===e||"Terrain"===e?(t=L.esri.basemapLayer(e+"Labels"),o.addLayer(t)):e.includes("Imagery")&&(t=L.esri.basemapLayer("ImageryLabels"),o.addLayer(t))}(e.target.value)}),$.getJSON("data/cityData.geojson").done(function(t){var n,i,d,l,u=function(e){var t=[],o=1/0,n=-1/0;for(var r in e.features){var a=e.features[r].properties;for(var i in a)"id"!=i&&"name"!=i&&"latitude"!=i&&"longitude"!=i&&(-1===$.inArray(i,t)&&t.push(i),a[i]<o&&(o=a[i]),a[i]>n&&(n=a[i]))}return{timestamps:t,min:o,max:n}}(t);!function(t,n){e=L.geoJson(n,{pointToLayer:function(e,t){return L.circleMarker(t,{fillColor:"#708598",color:"#00008B",weight:4,fillOpacity:.4}).on({mouseover:function(e){this.openPopup(),this.setStyle({color:"#00BFFF"})},mouseout:function(e){this.closePopup(),this.setStyle({color:"#00008B"})}})}}).addTo(o),r(t[0])}(u.timestamps,t),function(e,t){e<10&&(e=10);function n(e){return 10*Math.round(e/10)}var r=L.control({position:"bottomright"});r.onAdd=function(o){var r,i,d,l=L.DomUtil.create("div","legend"),u=L.DomUtil.create("div","symbolsContainer"),s=[n(e),n((t-e)/2),n(t)],m=0;L.DomEvent.addListener(l,"mousedown",function(e){L.DomEvent.stopPropagation(e)}),$(l).append("<h2 id='legendTitle'># of people unemployed</h2>");for(var c=0;c<=s.length-1;c++)r=L.DomUtil.create("div","legendCircle"),i=a(s[c]),d=-i-m-2,$(r).attr("style","width: "+2*i+"px; height: "+2*i+"px; margin-left: "+d+"px"),$(r).append("<span class='legendValue'>"+s[c]+"<span>"),$(u).append(r),m=i;return $(l).append(u),l},r.addTo(o)}(u.min,u.max),n=u.timestamps,(i=L.control({position:"bottomleft"})).onAdd=function(e){var t=L.DomUtil.create("input","range-slider");return $(t).mousedown(function(){e.dragging.disable()}),$(document).mouseup(function(){e.dragging.enable()}),L.DomEvent.addListener(t,"mousedown",function(e){L.DomEvent.stopPropagation(e)}),$(t).attr({type:"range",max:10,min:0,step:1,value:0}).on("input change",function(){r(n[$(this).val()]),$(".temporal-legend").text("Unemployment in "+n[this.value])}),t},i.addTo(o),d="Unemployment in "+n[0],(l=L.control({position:"bottomleft"})).onAdd=function(e){var t=L.DomUtil.create("output","temporal-legend");return t},l.addTo(o),$(".temporal-legend").text(d)}).fail(function(){alert("There has been a problem loading the data.")}),L.Control.textbox=L.Control.extend({onAdd:function(e){var t=L.DomUtil.create("div");return t.id="info_text",t.innerHTML="<strong><b><u>Metropolitan Area Unemployment in the United States</u></b> <br><br> Data for <i>cities</i> was held for the month of June of each year <br><br> Data Source: U.S. Department of Labor - Bureau of Labor Statistics </strong>",t},onRemove:function(e){}}),L.control.textbox=function(e){return new L.Control.textbox(e)},L.control.textbox({position:"bottomleft"}).addTo(o),L.Control.textbox=L.Control.extend({onAdd:function(e){var t=L.DomUtil.create("div");return t.id="info_text2",t.innerHTML="<strong>Basemap Gallery</strong>",t},onRemove:function(e){}}),L.control.textbox=function(e){return new L.Control.textbox(e)},L.control.textbox({position:"topright"}).addTo(o)});